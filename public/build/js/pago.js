console.log("Pago...");var total_paypal,itemsCarrito=JSON.parse(localStorage.getItem("productos"))||[];function fechaActual(){let t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`}function cantidadProdcutos(){let t=0;return itemsCarrito.forEach((o=>{t+=o.cantidad})),t}function calcularTotales(){console.log("calculando totales...");let t=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});const o=document.querySelector("#productos-cantidad"),e=document.querySelector("#subtotal"),a=document.querySelector("#total");let r=0;itemsCarrito.forEach((t=>{let o=t.precio;r+=t.cantidad*o})),total_paypal=r,o.textContent=`(${cantidadProdcutos()})`,e.textContent=t.format(r),a.textContent=t.format(r)}function fnPaypal(){paypal.Buttons({style:{color:"blue",shape:"pill",label:"pay"},createOrder:function(t,o){return o.order.create({purchase_units:[{amount:{value:total_paypal}}]})},onApprove:function(t,o){o.order.capture().then((function(t){if(console.log(t),"COMPLETED"===t.status){console.log("pago completado correctamente"),itemsCarrito.map((o=>o.id_pedido=t.id));const o=itemsCarrito.map((({imagen:t,...o})=>o));guardarPedido(t,o)}}))},onCancel:function(t){console.log(t)}}).render("#paypal-button-container")}async function guardarPedido(t,o){try{const e=new FormData;e.append("id_pedido",t.id),e.append("nombre",t.payer.name.given_name),e.append("apellidos",t.payer.name.surname),e.append("correo_electronico",t.payer.email_address),e.append("codigo_pais",t.payer.address.country_code),e.append("fecha",fechaActual()),e.append("productos",JSON.stringify(o));const a="/api/guardarPedido",r=await fetch(a,{method:"POST",body:e});if(r.ok){console.log("Pedido guardado...");const t=await r.json();console.log("res: ",t),t.datos.resultado&&(console.log("resultado true..."),itemsCarrito=[],sincronizarLS(),calcularTotales(),cantidadProdcutos(),window.location.href="/")}}catch(t){console.log(t)}}function sincronizarLS(){localStorage.setItem("productos",JSON.stringify(itemsCarrito))}document.addEventListener("DOMContentLoaded",(()=>{console.log(itemsCarrito),cantidadProdcutos(),calcularTotales(),fnPaypal()}));